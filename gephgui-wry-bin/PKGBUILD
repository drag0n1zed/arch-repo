# Maintainer: Geph Team <contact@geph.io>
# Contributor: drag <drag0n1zed@outlook.com>
pkgname=gephgui-wry-bin
pkgver=0.0.1
pkgrel=1
pkgdesc="The desktop GUI for Geph (pre-compiled binary)"
arch=('x86_64')
url="https://github.com/geph-official/gephgui-wry"
license=('GPL3')
depends=('webkit2gtk')
provides=('gephgui-wry')
conflicts=('gephgui-wry' 'gephgui-wry-git')
source=("https://github.com/geph-official/gephgui-pkg/releases/download/v${pkgver}/gephgui-wry_${pkgver}_amd64.deb"
        "gephgui-wry.sh")
sha256sums=('5f02454b1af0b0ed9d27083ef3b83830b335cff15ad8617b7603864091fd00f1'
        'SKIP')

package() {
  tar -xf "${srcdir}/data.tar.zst" -C "${srcdir}/"

  find "${pkgdir}" -type d -exec chmod 755 {} +
  find "${pkgdir}" -type f -exec chmod 644 {} +

  # --- START DIAGNOSTIC SECTION ---
  echo "================================================="
  echo "DEBUG: Recursively listing all files in the source directory (\$srcdir):"
  ls -lR "${srcdir}"
  echo "================================================="
  # --- END DIAGNOSTIC SECTION ---

  sed -i 's|^Exec=.*|Exec=gephgui-wry.sh|' "${srcdir}/usr/share/applications/gephgui-wry.desktop"

  install -Dm755 "${srcdir}/gephgui-wry.sh" "${pkgdir}/usr/bin/gephgui-wry.sh"

  cp -dr --no-preserve=ownership "${srcdir}/usr" "${pkgdir}/"
}
